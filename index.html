<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
  <title>Vybes AR Player</title>

  <!-- A-Frame core (pinned commit like you had) -->
  <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@e47f441/dist/aframe-master.min.js"></script>

  <!-- A-Frame Extras -->
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>

  <!-- AR.js for A-Frame -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.7/aframe/build/aframe-ar-nft.js"></script>

  <style>
    * {
      -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    }

    body {
      margin: 0;
      overflow: hidden;
      background: black;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    .arjs-loader {
      height: 100%;
      width: 100%;
      position: absolute;
      top: 0;
      left: 0;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .arjs-loader-inner {
      text-align: center;
      color: white;
    }

    .spinner {
      margin: 16px auto;
      width: 50px;
      height: 40px;
      text-align: center;
      font-size: 10px;
    }

    .spinner>div {
      background-color: white;
      height: 100%;
      width: 6px;
      display: inline-block;
      animation: stretchdelay 1.2s infinite ease-in-out;
    }

    .spinner .rect2 {
      animation-delay: -1.1s;
    }

    .spinner .rect3 {
      animation-delay: -1.0s;
    }

    .spinner .rect4 {
      animation-delay: -0.9s;
    }

    .spinner .rect5 {
      animation-delay: -0.8s;
    }

    @keyframes stretchdelay {
      0%, 40%, 100% {
        transform: scaleY(0.4);
      }

      20% {
        transform: scaleY(1.0);
      }
    }

    .arrow-container {
      position: relative;
      width: 50px;
      height: 50px;
      margin: 16px auto 0;
      animation: bounce 2s ease-in-out infinite;
    }

    .arrow-line,
    .arrow-line2 {
      position: absolute;
      width: 50px;
      border: 4px solid #fff;
      border-radius: 15px;
    }

    .arrow-line {
      transform: rotate(45deg);
      left: 10px;
      bottom: 8px;
    }

    .arrow-line2 {
      transform: rotate(-45deg);
      left: -10px;
      bottom: 8px;
    }

    @keyframes bounce {
      0% {
        transform: translateY(8px);
      }

      50% {
        transform: translateY(0);
      }

      100% {
        transform: translateY(8px);
      }
    }

    #loader-message {
      margin-top: 8px;
      margin-bottom: 8px;
    }

    #playButton {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 9999;
    }

    #playButton img {
      width: 64px;
      height: 64px;
    }

    #branding {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: coral;
      font-weight: bold;
      letter-spacing: 2px;
      font-size: 13px;
      z-index: 9998;
      text-transform: uppercase;
    }
  </style>

  <script>
    // Your original play-on-window-click component
    AFRAME.registerComponent('play-on-window-click', {
      init: function () {
        this.onClick = this.onClick.bind(this);
      },
      play: function () {
        window.addEventListener('click', this.onClick);
      },
      pause: function () {
        window.removeEventListener('click', this.onClick);
      },
      onClick: function () {
        var video = document.getElementById('video');
        if (!video) return;

        var image = document.getElementById('playImage');

        if (video.paused) {
          video.play().catch(function (e) {
            console.warn('Video play blocked:', e);
          });
          if (image) image.src = "pause.png";
        } else {
          video.pause();
          if (image) image.src = "play.png";
        }
      }
    });

    // Remove loader and show play button when AR.js camera is ready
    window.addEventListener('camera-init', function () {
      var loader = document.getElementById('loader');
      if (loader) loader.remove();

      // Play button UI
      var btn = document.createElement('header');
      btn.id = "playButton";
      document.body.appendChild(btn);

      var img = document.createElement('img');
      img.id = "playImage";
      img.src = "play.png";
      btn.appendChild(img);
    });

    // Simple cookie cleanup (optional, from your original)
    function eraseCookieFromAllPaths(name) {
      var pathBits = location.pathname.split('/');
      var pathCurrent = ' path=';

      document.cookie = name + '=; expires=Thu, 01-Jan-1970 00:00:01 GMT;';

      for (var i = 0; i < pathBits.length; i++) {
        pathCurrent += ((pathCurrent.substr(-1) != '/') ? '/' : '') + pathBits[i];
        document.cookie = name + '=; expires=Thu, 01-Jan-1970 00:00:01 GMT;' + pathCurrent + ';';
      }
    }
    eraseCookieFromAllPaths("__cfduid");
  </script>
</head>

<body>

  <!-- Loader -->
  <div class="arjs-loader" id="loader">
    <div class="arjs-loader-inner">
      <div id="loader-message">Loading the hack.. Please wait.</div>
      <div class="spinner">
        <div class="rect1"></div>
        <div class="rect2"></div>
        <div class="rect3"></div>
        <div class="rect4"></div>
        <div class="rect5"></div>
      </div>
      <div id="message">Raise the device to your eye-level</div>
      <div class="arrow-container">
        <div class="arrow-line"></div>
        <div class="arrow-line2"></div>
      </div>
      <p><strong style="color: coral;">POWERED BY AVRLY</strong></p>
    </div>
  </div>

  <!-- Fixed HTML branding -->
  <div id="branding">POWERED BY AVRLY</div>

  <a-scene
    vr-mode-ui="enabled: false"
    renderer="logarithmicDepthBuffer: true; antialias: true"
    embedded
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false"
    device-orientation-permission-ui="enabled: true">

    <!-- Standard AR.js camera -->
    <a-camera user-height="0" cursor="fuse:false" ar-raycaster raycaster="objects:none"></a-camera>

    <a-assets>
      <!-- IMPORTANT: file name must be exactly Vybes.MP4 in the repo -->
      <video
        id="video"
        src="Vybes.MP4"
        loop
        crossorigin="anonymous"
        webkit-playsinline
        playsinline>
      </video>
    </a-assets>

    <!-- Background panel behind video (for wow effect) -->
    <a-plane
      position="0 1.4 -4"
      rotation="0 0 0"
      width="2.2"
      height="1.4"
      material="color: #050608; opacity: 0.9; metalness: 0.4; roughness: 0.2; side: double">
    </a-plane>

    <!-- Neon border -->
    <a-plane
      position="0 1.4 -3.98"
      rotation="0 0 0"
      width="2.26"
      height="1.46"
      material="color: #ff7f50; opacity: 0.7; wireframe: true; side: double">
    </a-plane>

    <!-- Video surface: 16:9 aspect -->
    <a-plane
      src="#video"
      position="0 1.4 -3.95"
      rotation="0 0 0"
      width="1.6"
      height="0.9"
      material="shader: flat; side: double"
      play-on-window-click>
    </a-plane>

  </a-scene>
</body>

</html>
